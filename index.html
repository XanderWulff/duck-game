<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Duck Hiding Game</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: #f5f5f5;
            padding: 20px;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        h1 {
            text-align: center;
            margin-bottom: 30px;
            color: #2c3e50;
        }

        /* Scoreboard Styles */
        .scoreboard {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 30px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .scoreboard h2 {
            margin-bottom: 20px;
            color: #2c3e50;
            border-bottom: 2px solid #eee;
            padding-bottom: 10px;
        }

        .score-item {
            display: flex;
            align-items: center;
            padding: 15px;
            margin-bottom: 10px;
            background: #f8f9fa;
            border-radius: 6px;
            border-left: 4px solid;
        }

        .score-rank {
            font-size: 24px;
            font-weight: bold;
            color: #666;
            min-width: 40px;
        }

        .score-duck {
            flex: 1;
            margin-left: 15px;
        }

        .duck-name {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .duck-location {
            font-size: 14px;
            color: #666;
            margin-bottom: 3px;
        }

        .duck-times {
            font-size: 14px;
            color: #888;
        }

        .time-highlight {
            font-weight: bold;
            color: #2c3e50;
        }

        /* Controls Section */
        .controls {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 30px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .controls h2 {
            margin-bottom: 20px;
            color: #2c3e50;
            border-bottom: 2px solid #eee;
            padding-bottom: 10px;
        }

        .duck-control {
            margin-bottom: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 6px;
            border-left: 4px solid;
        }

        .duck-control h3 {
            margin-bottom: 10px;
        }

        .control-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 10px;
        }

        button {
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            background: #3498db;
            color: white;
            font-size: 14px;
            cursor: pointer;
            transition: background 0.3s;
        }

        button:hover {
            background: #2980b9;
        }

        button:disabled {
            background: #bdc3c7;
            cursor: not-allowed;
        }

        .room-select {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 10px;
        }

        .room-btn {
            padding: 8px 16px;
            background: #95a5a6;
        }

        .room-btn:hover {
            background: #7f8c8d;
        }

        /* History Section */
        .history {
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .history h2 {
            margin-bottom: 20px;
            color: #2c3e50;
            border-bottom: 2px solid #eee;
            padding-bottom: 10px;
        }

        .history-item {
            padding: 12px;
            margin-bottom: 8px;
            background: #f8f9fa;
            border-radius: 4px;
            border-left: 4px solid;
            font-size: 14px;
        }

        .history-time {
            color: #666;
            font-size: 12px;
        }

        /* Duck Colors */
        .red { border-left-color: #e74c3c; }
        .blue { border-left-color: #3498db; }
        .green { border-left-color: #2ecc71; }
        .gold { border-left-color: #f39c12; }
        .pink { border-left-color: #e91e63; }

        .duck-name.red { color: #e74c3c; }
        .duck-name.blue { color: #3498db; }
        .duck-name.green { color: #2ecc71; }
        .duck-name.gold { color: #f39c12; }
        .duck-name.pink { color: #e91e63; }

        /* Loading State */
        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }

        /* Responsive */
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }

            .score-item {
                flex-direction: column;
                align-items: flex-start;
            }

            .score-rank {
                margin-bottom: 10px;
            }

            .control-buttons {
                flex-direction: column;
            }

            button {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ü¶Ü Duck Hiding Game</h1>

        <!-- Scoreboard -->
        <div class="scoreboard">
            <h2>Scoreboard</h2>
            <div id="scoreboard-content" class="loading">Loading...</div>
        </div>

        <!-- Controls -->
        <div class="controls">
            <h2>Game Controls</h2>
            <div id="controls-content"></div>
        </div>

        <!-- History -->
        <div class="history">
            <h2>Game History</h2>
            <div id="history-content" class="loading">Loading...</div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getDatabase, ref, set, get, push, onValue, update } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js';

        // Firebase configuration - YOU NEED TO REPLACE THIS WITH YOUR CONFIG
        const firebaseConfig = {
            apiKey: "AIzaSyDJMxB0yrv0y__JocgIz5MDk_z-KzfSX0w",
            authDomain: "duck-hiding-game.firebaseapp.com",
            databaseURL: "https://duck-hiding-game-default-rtdb.firebaseio.com",
            projectId: "duck-hiding-game",
            storageBucket: "duck-hiding-game.firebasestorage.app",
            messagingSenderId: "149235742097",
            appId: "1:149235742097:web:59dfc8a926a4ec0d101630"
        };

        const app = initializeApp(firebaseConfig);
        const database = getDatabase(app);

        const ducks = ['red', 'blue', 'green', 'gold', 'pink'];
        const rooms = ['Red Room', 'Blue Room', 'Green Room', 'Gold Room', 'Pink Room'];

        // Initialize database structure if needed
        async function initializeDatabase() {
            const dbRef = ref(database, 'ducks');
            const snapshot = await get(dbRef);
            
            if (!snapshot.exists()) {
                const initialData = {};
                ducks.forEach(duck => {
                    initialData[duck] = {
                        totalTime: 0,
                        currentSession: null,
                        location: 'Ready to hide',
                        isHidden: false
                    };
                });
                await set(dbRef, initialData);
                await set(ref(database, 'history'), {});
            }
        }

        // Format time in HH:MM:SS
        function formatTime(seconds) {
            const hours = Math.floor(seconds / 3600);
            const minutes = Math.floor((seconds % 3600) / 60);
            const secs = seconds % 60;
            return `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
        }

        // Calculate current session duration
        function getCurrentSessionTime(startTime) {
            if (!startTime) return 0;
            return Math.floor((Date.now() - startTime) / 1000);
        }

        // Render scoreboard
        function renderScoreboard(ducksData) {
            const scores = ducks.map(duck => {
                const data = ducksData[duck] || {};
                const currentTime = data.currentSession ? getCurrentSessionTime(data.currentSession.startTime) : 0;
                const totalTime = (data.totalTime || 0) + currentTime;
                
                return {
                    duck,
                    totalTime,
                    currentTime,
                    location: data.location || 'Ready to hide',
                    isHidden: data.isHidden || false
                };
            }).sort((a, b) => b.totalTime - a.totalTime);

            const html = scores.map((score, index) => `
                <div class="score-item ${score.duck}">
                    <div class="score-rank">#${index + 1}</div>
                    <div class="score-duck">
                        <div class="duck-name ${score.duck}">${score.duck.charAt(0).toUpperCase() + score.duck.slice(1)} Duck</div>
                        <div class="duck-location">üìç ${score.location}</div>
                        <div class="duck-times">
                            <span class="time-highlight" id="total-${score.duck}">${formatTime(score.totalTime)}</span> total
                            ${score.isHidden ? ` | <span class="time-highlight" id="current-${score.duck}">${formatTime(score.currentTime)}</span> current` : ''}
                        </div>
                    </div>
                </div>
            `).join('');

            document.getElementById('scoreboard-content').innerHTML = html;
        }

        // Render controls
        function renderControls(ducksData) {
            const html = ducks.map(duck => {
                const data = ducksData[duck] || {};
                const isHidden = data.isHidden || false;
                
                return `
                    <div class="duck-control ${duck}">
                        <h3 class="duck-name ${duck}">${duck.charAt(0).toUpperCase() + duck.slice(1)} Duck</h3>
                        <div class="control-buttons">
                            ${!isHidden ? `
                                <button onclick="window.showRoomSelect('${duck}')">Hide Duck</button>
                                <div class="room-select" id="rooms-${duck}" style="display: none;">
                                    ${rooms.filter(room => !room.toLowerCase().includes(duck)).map(room => `
                                        <button class="room-btn" onclick="window.hideDuck('${duck}', '${room}')">${room}</button>
                                    `).join('')}
                                </div>
                            ` : `
                                <button onclick="window.findDuck('${duck}')">Mark as Found</button>
                            `}
                        </div>
                    </div>
                `;
            }).join('');

            document.getElementById('controls-content').innerHTML = html;
        }

        // Render history
        async function renderHistory() {
            const historyRef = ref(database, 'history');
            const snapshot = await get(historyRef);
            
            if (!snapshot.exists()) {
                document.getElementById('history-content').innerHTML = '<p style="color: #666;">No history yet. Start hiding ducks!</p>';
                return;
            }

            const history = snapshot.val();
            const historyArray = Object.entries(history).map(([key, value]) => ({
                ...value,
                id: key
            })).sort((a, b) => b.endTime - a.endTime);

            const html = historyArray.map(item => {
                const duration = Math.floor((item.endTime - item.startTime) / 1000);
                const date = new Date(item.endTime).toLocaleString();
                
                return `
                    <div class="history-item ${item.duck}">
                        <div><strong class="duck-name ${item.duck}">${item.duck.charAt(0).toUpperCase() + item.duck.slice(1)} Duck</strong> was hidden in <strong>${item.location}</strong></div>
                        <div>Duration: <strong>${formatTime(duration)}</strong></div>
                        <div class="history-time">Found on ${date}</div>
                    </div>
                `;
            }).join('');

            document.getElementById('history-content').innerHTML = html || '<p style="color: #666;">No history yet.</p>';
        }

        // Hide duck
        window.hideDuck = async function(duck, room) {
            const duckRef = ref(database, `ducks/${duck}`);
            await update(duckRef, {
                currentSession: {
                    startTime: Date.now(),
                    location: room
                },
                location: room,
                isHidden: true
            });
            
            // Hide room selector
            document.getElementById(`rooms-${duck}`).style.display = 'none';
        };

        // Find duck
        window.findDuck = async function(duck) {
            const duckRef = ref(database, `ducks/${duck}`);
            const snapshot = await get(duckRef);
            const data = snapshot.val();
            
            if (!data.currentSession) return;
            
            const duration = Math.floor((Date.now() - data.currentSession.startTime) / 1000);
            const newTotalTime = (data.totalTime || 0) + duration;
            
            // Add to history
            const historyRef = ref(database, 'history');
            await push(historyRef, {
                duck: duck,
                location: data.currentSession.location,
                startTime: data.currentSession.startTime,
                endTime: Date.now(),
                duration: duration
            });
            
            // Update duck data
            await update(duckRef, {
                totalTime: newTotalTime,
                currentSession: null,
                location: 'Ready to hide',
                isHidden: false
            });
            
            renderHistory();
        };

        // Show room selector
        window.showRoomSelect = function(duck) {
            const roomsDiv = document.getElementById(`rooms-${duck}`);
            roomsDiv.style.display = roomsDiv.style.display === 'none' ? 'flex' : 'none';
        };

        // Update live timers every second
        setInterval(() => {
            ducks.forEach(async duck => {
                const duckRef = ref(database, `ducks/${duck}`);
                const snapshot = await get(duckRef);
                const data = snapshot.val();
                
                if (data && data.currentSession) {
                    const currentTime = getCurrentSessionTime(data.currentSession.startTime);
                    const totalTime = (data.totalTime || 0) + currentTime;
                    
                    const currentElem = document.getElementById(`current-${duck}`);
                    const totalElem = document.getElementById(`total-${duck}`);
                    
                    if (currentElem) currentElem.textContent = formatTime(currentTime);
                    if (totalElem) totalElem.textContent = formatTime(totalTime);
                }
            });
        }, 1000);

        // Listen for real-time updates
        const ducksRef = ref(database, 'ducks');
        onValue(ducksRef, (snapshot) => {
            const data = snapshot.val();
            if (data) {
                renderScoreboard(data);
                renderControls(data);
            }
        });

        // Initialize
        initializeDatabase().then(() => {
            renderHistory();
        });
    </script>
</body>
</html>
